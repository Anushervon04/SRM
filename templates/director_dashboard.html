<!DOCTYPE html>
<html lang="tj">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü–∞–Ω–µ–ª–∏ –î–∏—Ä–µ–∫—Ç–æ—Ä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* –ê–Ω–∏–º–∞—Ü–∏—è“≥–æ */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –¢–∞–±“≥–æ –±–∞—Ä–æ–∏ –º–æ–±–∞–π–ª */
        .mobile-tabs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            padding: 1rem;
        }

        .mobile-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem 0.5rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 80px;
        }

        .mobile-tab:active:not([disabled]) {
            transform: scale(0.95);
        }

        .mobile-tab.active {
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
            color: white;
            border-color: #4f46e5;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .mobile-tab[disabled] {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .mobile-tab-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        /* Desktop —Ç–∞–±“≥–æ */
        .desktop-tabs {
            display: none;
        }

        @media (min-width: 768px) {
            .mobile-tabs {
                display: none;
            }
            .desktop-tabs {
                display: flex;
                border-bottom: 2px solid #e5e7eb;
                background: #f9fafb;
                overflow-x: auto;
            }
            .tab-button {
                position: relative;
                padding: 1rem 1.5rem;
                font-weight: 600;
                color: #6b7280;
                transition: all 0.3s ease;
                white-space: nowrap;
                border: none;
                background: none;
                cursor: pointer;
            }
            .tab-button.active {
                color: #4f46e5;
            }
            .tab-button.active::after {
                content: '';
                position: absolute;
                bottom: -2px;
                left: 0;
                right: 0;
                height: 3px;
                background: #4f46e5;
            }
            .tab-button[disabled] {
                opacity: 0.5;
                cursor: not-allowed;
            }
        }

        /* –ë–∞—Ö—à“≥–æ */
        .section-content {
            display: none;
        }
        
        .section-content.active {
            display: block;
        }

        /* –ö–∞—Ä—Ç–∞“≥–æ–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞—Ä–æ–∏ –º–æ–±–∞–π–ª */
        .stat-card {
            background: white;
            border-radius: 1rem;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-card-mobile {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        /* “∂–∞–¥–≤–∞–ª“≥–æ –±–∞—Ä–æ–∏ –º–æ–±–∞–π–ª */
        @media (max-width: 767px) {
            .mobile-table-card {
                background: white;
                border-radius: 1rem;
                padding: 1rem;
                margin-bottom: 0.75rem;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
                border-left: 4px solid #4f46e5;
            }
            
            .mobile-table-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0;
                border-bottom: 1px solid #f3f4f6;
            }
            
            .mobile-table-row:last-child {
                border-bottom: none;
            }
            
            .mobile-table-label {
                font-size: 0.875rem;
                color: #6b7280;
                font-weight: 500;
            }
            
            .mobile-table-value {
                font-size: 0.875rem;
                font-weight: 600;
                color: #1f2937;
            }

            .desktop-table {
                display: none;
            }
        }

        @media (min-width: 768px) {
            .mobile-table-card {
                display: none;
            }
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Progress bar */
        .progress-bar {
            transition: width 0.5s ease;
        }

        /* –¢—É–≥–º–∞“≥–æ –±–∞—Ä–æ–∏ –º–æ–±–∞–π–ª */
        .mobile-action-btn {
            width: 100%;
            padding: 0.75rem;
            background: #4f46e5;
            color: white;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mobile-action-btn:active {
            transform: scale(0.98);
            background: #4338ca;
        }

        /* Floating action button –±–∞—Ä–æ–∏ –º–æ–±–∞–π–ª */
        .fab {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .fab:active {
            transform: scale(0.9);
        }

        @media (min-width: 768px) {
            .fab {
                display: none;
            }
        }

        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Hover —ç—Ñ—Ñ–µ–∫—Ç */
        .hover-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .hover-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        /* Header –±–∞—Ä–æ–∏ –º–æ–±–∞–π–ª */
        @media (max-width: 767px) {
            .mobile-header {
                padding: 1rem;
            }
            .mobile-header h1 {
                font-size: 1.25rem;
            }
            .mobile-header p {
                font-size: 0.75rem;
            }
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –∞—Å–æ—Å”£ */
        .main-container {
            padding-bottom: 5rem;
        }

        @media (min-width: 768px) {
            .main-container {
                padding-bottom: 2rem;
            }
        }

        /* Breadcrumb */
        .breadcrumb {
            display: none;
        }

        @media (min-width: 768px) {
            .breadcrumb {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-size: 0.875rem;
                color: #6b7280;
                margin-bottom: 1rem;
            }
            
            .breadcrumb-item:not(:last-child)::after {
                content: '‚Ä∫';
                margin-left: 0.5rem;
                color: #9ca3af;
            }
        }

        /* Select –±–∞—Ä–æ–∏ –º–æ–±–∞–π–ª */
        @media (max-width: 767px) {
            select {
                font-size: 1rem;
                padding: 0.875rem;
                border-radius: 0.75rem;
            }
        }

        /* –ö–Ω–æ–ø–∫–∞–∏ –±–æ–∑–≥–∞—à—Ç */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            font-weight: 600;
            color: #4f46e5;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 1rem;
        }

        .back-button:active {
            transform: scale(0.95);
            background: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-gradient-to-r from-indigo-600 to-indigo-800 text-white shadow-xl sticky top-0 z-50">
        <div class="mobile-header max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-xl md:text-3xl font-bold">üìä –ü–∞–Ω–µ–ª–∏ –ò–¥–æ—Ä–∞–∫—É–Ω”£</h1>
                    <p class="text-indigo-200 text-xs md:text-sm mt-1">–°–∏—Å—Ç–µ–º–∞–∏ –Ω–∞–∑–æ—Ä–∞—Ç–∏ –¥–∞–≤–æ–º–æ—Ç</p>
                </div>
                <div class="text-right text-xs md:text-base">
                    <p class="text-indigo-200 text-xs">–ò–º—Ä”Ø–∑</p>
                    <p class="font-semibold" id="current-date"></p>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 py-4 md:py-8 w-full main-container">
        
        <!-- Breadcrumb –±–∞—Ä–æ–∏ desktop -->
        <div class="breadcrumb">
            <span class="breadcrumb-item cursor-pointer hover:text-indigo-600" onclick="showSection('dashboard')">–ê—Å–æ—Å”£</span>
            <span class="breadcrumb-item" id="breadcrumb-current">–û–º–æ—Ä–∏ —É–º—É–º”£</span>
        </div>

        <!-- –ö–∞—Ä—Ç–∞“≥–æ–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <section class="mb-4 md:mb-8 fade-in">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-6">
                <div class="stat-card">
                    <div class="stat-card-mobile md:flex md:items-center md:justify-between">
                        <div class="flex-1">
                            <p class="text-gray-500 text-xs md:text-sm font-medium mb-1">–î–æ–Ω–∏—à“∑”Ø—ë–Ω</p>
                            <p id="total-students" class="text-xl md:text-3xl font-bold text-gray-800">...</p>
                        </div>
                        <div class="stat-icon bg-blue-100 hidden md:flex">
                            üë•
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card-mobile md:flex md:items-center md:justify-between">
                        <div class="flex-1">
                            <p class="text-gray-500 text-xs md:text-sm font-medium mb-1">“≤–æ–∑–∏—Ä–æ–Ω</p>
                            <p id="total-present" class="text-xl md:text-3xl font-bold text-green-600">...</p>
                        </div>
                        <div class="stat-icon bg-green-100 hidden md:flex">
                            ‚úÖ
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card-mobile md:flex md:items-center md:justify-between">
                        <div class="flex-1">
                            <p class="text-gray-500 text-xs md:text-sm font-medium mb-1">“í–æ–∏–±–æ–Ω</p>
                            <p id="total-absent" class="text-xl md:text-3xl font-bold text-red-600">...</p>
                        </div>
                        <div class="stat-icon bg-red-100 hidden md:flex">
                            ‚ùå
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card-mobile md:flex md:items-center md:justify-between">
                        <div class="flex-1">
                            <p class="text-gray-500 text-xs md:text-sm font-medium mb-1">–§–æ–∏–∑–∏ —É–º—É–º”£</p>
                            <p id="total-percentage" class="text-xl md:text-3xl font-bold text-indigo-600">...</p>
                        </div>
                        <div class="stat-icon bg-indigo-100 hidden md:flex">
                            üìä
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- –ù–∞–≤–∏–≥–∞—Ç—Å–∏—è–∏ –º–æ–±–∏–ª”£ (Grid Style) -->
        <div class="mobile-tabs">
            <button class="mobile-tab active" onclick="showSection('dashboard')" data-section="dashboard">
                <div class="mobile-tab-icon">üìã</div>
                <div>–ì—É—Ä”Ø“≥“≥–æ</div>
            </button>
            <button class="mobile-tab" onclick="showSection('absent-today')" data-section="absent-today">
                <div class="mobile-tab-icon">‚ùå</div>
                <div>“í–æ–∏–±–æ–Ω</div>
            </button>
            <button class="mobile-tab" onclick="showSection('weekly')" data-section="weekly">
                <div class="mobile-tab-icon">üìÖ</div>
                <div>“≤–∞—Ñ—Ç–∞–∏–Ω–∞</div>
            </button>
            <button class="mobile-tab" onclick="showSection('monthly')" data-section="monthly">
                <div class="mobile-tab-icon">üìÜ</div>
                <div>–ú–æ“≥–æ–Ω–∞</div>
            </button>
            <button class="mobile-tab" onclick="showSection('problem')" data-section="problem">
                <div class="mobile-tab-icon">‚ö†Ô∏è</div>
                <div>–ü—Ä–æ–±–ª–µ–º–∞</div>
            </button>
            <button class="mobile-tab" onclick="generateMonthlyReport()" data-section="report">
                <div class="mobile-tab-icon">üìÑ</div>
                <div>“≤–∏—Å–æ–±–æ—Ç</div>
            </button>
        </div>

        <!-- Desktop —Ç–∞–±“≥–æ -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="desktop-tabs">
                <button class="tab-button active" onclick="showSection('dashboard')" data-tab="dashboard">
                    üìä –ì—É—Ä”Ø“≥“≥–æ
                </button>
                <button class="tab-button" onclick="showSection('absent-today')" data-tab="absent-today">
                    ‚ùå “í–æ–∏–±–æ–Ω (–∏–º—Ä”Ø–∑)
                </button>
                <button class="tab-button" onclick="showSection('weekly')" data-tab="weekly">
                    üìÖ “≤–∞—Ñ—Ç–∞–∏–Ω–∞
                </button>
                <button class="tab-button" onclick="showSection('monthly')" data-tab="monthly">
                    üìÜ –ú–æ“≥–æ–Ω–∞
                </button>
                <button class="tab-button" onclick="showSection('problem')" data-tab="problem">
                    ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞
                </button>
                <button class="tab-button" onclick="generateMonthlyReport()" data-tab="report">
                    üìÑ “≤–∏—Å–æ–±–æ—Ç
                </button>
            </div>

            <div class="p-4 md:p-8">
                <!-- –ë–∞—Ö—à–∏ –ì—É—Ä”Ø“≥“≥–æ -->
                <div id="section-dashboard" class="section-content active fade-in">
                    <div class="mb-4 md:mb-6">
                        <h2 class="text-lg md:text-2xl font-bold text-gray-800 mb-2 md:mb-4">–í–∞–∑—ä–∏ –≥—É—Ä”Ø“≥“≥–æ</h2>
                        <select id="course-select" class="w-full p-3 border-2 border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" onchange="loadGroups()">
                            <option value="">“≤–∞–º–∞–∏ –∫—É—Ä—Å“≥–æ</option>
                        </select>
                    </div>

                    <!-- Mobile Cards -->
                    <div id="groups-mobile" class="block md:hidden"></div>

                    <!-- Desktop Table -->
                    <div class="desktop-table overflow-x-auto rounded-lg border border-gray-200">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100 border-b-2 border-gray-200">
                                <tr>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ì—É—Ä”Ø“≥</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ö—É—Ä—Å</th>
                                    <th class="p-4 text-center text-sm font-semibold text-gray-700">“≤–æ–∑–∏—Ä</th>
                                    <th class="p-4 text-center text-sm font-semibold text-gray-700">“í–æ–∏–±</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–î–∞–≤–æ–º–æ—Ç</th>
                                    <th class="p-4 text-center text-sm font-semibold text-gray-700">–ê–º–∞–ª–∏—ë—Ç</th>
                                </tr>
                            </thead>
                            <tbody id="groups-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>

                    <!-- –†”Ø–π—Ö–∞—Ç–∏ –¥–æ–Ω–∏—à“∑”Ø—ë–Ω -->
                    <div id="group-detail" class="mt-4 md:mt-8 hidden"></div>
                    
                    <!-- –ü—Ä–æ—Ñ–∏–ª–∏ –¥–æ–Ω–∏—à“∑”Ø -->
                    <div id="student-profile" class="mt-4 md:mt-6 hidden"></div>
                </div>

                <!-- –ë–∞—Ö—à–∏ “í–æ–∏–±–æ–Ω (–∏–º—Ä”Ø–∑) -->
                <div id="section-absent-today" class="section-content">
                    <h2 class="text-lg md:text-2xl font-bold text-gray-800 mb-4 md:mb-6">–†”Ø–π—Ö–∞—Ç–∏ “ì–æ–∏–±–æ–Ω (–∏–º—Ä”Ø–∑)</h2>
                    
                    <!-- Mobile Cards -->
                    <div id="absent-mobile" class="block md:hidden"></div>

                    <!-- Desktop Table -->
                    <div class="desktop-table overflow-x-auto rounded-lg border border-gray-200">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100 border-b-2 border-gray-200">
                                <tr>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ù–æ–º –≤–∞ –ù–∞—Å–∞–±</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ì—É—Ä”Ø“≥</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ö—É—Ä—Å</th>
                                </tr>
                            </thead>
                            <tbody id="absent-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>

                <!-- –ë–∞—Ö—à–∏ “≤–∞—Ñ—Ç–∞–∏–Ω–∞ -->
                <div id="section-weekly" class="section-content">
                    <h2 class="text-lg md:text-2xl font-bold text-gray-800 mb-4 md:mb-6">–î–∞–≤–æ–º–æ—Ç–∏ “≥–∞—Ñ—Ç–∞–∏–Ω–∞</h2>
                    
                    <!-- Mobile Cards -->
                    <div id="weekly-mobile" class="block md:hidden"></div>

                    <!-- Desktop Table -->
                    <div class="desktop-table overflow-x-auto rounded-lg border border-gray-200">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100 border-b-2 border-gray-200">
                                <tr>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ù–æ–º –≤–∞ –ù–∞—Å–∞–±</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ì—É—Ä”Ø“≥</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ö—É—Ä—Å</th>
                                    <th class="p-4 text-center text-sm font-semibold text-gray-700">“í–æ–∏–±”£</th>
                                </tr>
                            </thead>
                            <tbody id="weekly-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>

                <!-- –ë–∞—Ö—à–∏ –ú–æ“≥–æ–Ω–∞ -->
                <div id="section-monthly" class="section-content">
                    <h2 class="text-lg md:text-2xl font-bold text-gray-800 mb-4 md:mb-6">–î–∞–≤–æ–º–æ—Ç–∏ –º–æ“≥–æ–Ω–∞</h2>
                    
                    <!-- Mobile Cards -->
                    <div id="monthly-mobile" class="block md:hidden"></div>

                    <!-- Desktop Table -->
                    <div class="desktop-table overflow-x-auto rounded-lg border border-gray-200">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100 border-b-2 border-gray-200">
                                <tr>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ù–æ–º –≤–∞ –ù–∞—Å–∞–±</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ì—É—Ä”Ø“≥</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ö—É—Ä—Å</th>
                                    <th class="p-4 text-center text-sm font-semibold text-gray-700">“í–æ–∏–±”£</th>
                                </tr>
                            </thead>
                            <tbody id="monthly-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>

                <!-- –ë–∞—Ö—à–∏ –ü—Ä–æ–±–ª–µ–º–∞ -->
                <div id="section-problem" class="section-content">
                    <h2 class="text-lg md:text-2xl font-bold text-gray-800 mb-4 md:mb-6">–®–∞—Ö—Å–æ–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∞ (>6 “ì–æ–∏–±”£)</h2>
                    
                    <!-- Mobile Cards -->
                    <div id="problem-mobile" class="block md:hidden"></div>

                    <!-- Desktop Table -->
                    <div class="desktop-table overflow-x-auto rounded-lg border border-gray-200">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100 border-b-2 border-gray-200">
                                <tr>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ù–æ–º –≤–∞ –ù–∞—Å–∞–±</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ì—É—Ä”Ø“≥</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ö—É—Ä—Å</th>
                                    <th class="p-4 text-center text-sm font-semibold text-gray-700">“í–æ–∏–±”£</th>
                                </tr>
                            </thead>
                            <tbody id="problem-table" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gradient-to-r from-indigo-600 to-indigo-800 text-white py-4 mt-4">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-xs md:text-sm">üíª –ë–∞—Ä–Ω–æ–º–∞—Å–æ–∑: Anushervon | ¬© 2024</p>
        </div>
    </footer>

    <script>
        let courseMap = new Map();
        let groupMap = new Map();
        let currentSection = 'dashboard';

        // –§—É–Ω–∫—Å–∏—è –±–∞—Ä–æ–∏ –Ω–∏—à–æ–Ω –¥–æ–¥–∞–Ω–∏ –ø–∞—ë–º“≥–æ–∏ Toast
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-5 right-5 bg-${type === 'success' ? 'green' : 'red'}-600 text-white px-6 py-3 rounded-lg shadow-2xl flex items-center gap-3 max-w-[90%] sm:max-w-md z-[1000] fade-in`;
            toast.innerHTML = `
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                        d="${type === 'success' ? 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' : 'M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z'}"></path>
                </svg>
                <span class="text-sm md:text-base">${message}</span>`;
            document.body.appendChild(toast);
            setTimeout(() => { toast.remove(); }, 3000);
        }

        // –°–∞–Ω–∞–∏ “∑–æ—Ä”£
        function updateCurrentDate() {
            const options = { month: 'short', day: 'numeric' };
            const dateStr = new Date().toLocaleDateString('tg-TJ', options);
            document.getElementById('current-date').textContent = dateStr;
        }

        // –°–∞–Ω“∑–∏—à–∏ –æ—ë –º–æ“≥ –ø—É—Ä—Ä–∞ —à—É–¥–∞–∞—Å—Ç
        function isMonthComplete() {
            const today = new Date();
            const lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            return today.getDate() >= lastDayOfMonth.getDate();
        }

        // –ù–∞–≤—Å–æ–∑–∏–∏ –¥–∞—Å—Ç—Ä–∞—Å–∏–∏ —Ç—É–≥–º–∞–∏ “≥–∏—Å–æ–±–æ—Ç
        function updateReportButtonState() {
            const reportButtons = document.querySelectorAll('.mobile-tab[data-section="report"], .tab-button[data-tab="report"]');
            const isEnabled = isMonthComplete();
            
            reportButtons.forEach(btn => {
                if (!isEnabled) {
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                    btn.setAttribute('disabled', 'true');
                    btn.setAttribute('title', '“≤–∏—Å–æ–±–æ—Ç —Ç–∞–Ω“≥–æ –ø–∞—Å –∞–∑ –∞–Ω“∑–æ–º–∏ –º–æ“≥ –¥–∞—Å—Ç—Ä–∞—Å –∞—Å—Ç');
                } else {
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    btn.removeAttribute('disabled');
                    btn.removeAttribute('title');
                }
            });
        }

        // Loading
        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="flex flex-col justify-center items-center py-12">
                    <div class="spinner"></div>
                    <span class="text-gray-600 font-medium mt-3">–ë–æ—Ä–∫—É–Ω”£...</span>
                </div>`;
        }

        // –ì—É–∑–∞—à—Ç–∞–Ω –±–∞ –±–∞—Ö—à“≥–æ
        function showSection(sectionName) {
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.remove('active');
            });

            document.getElementById('group-detail').classList.add('hidden');
            document.getElementById('student-profile').classList.add('hidden');

            document.querySelectorAll('.mobile-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            const section = document.getElementById(`section-${sectionName}`);
            if (section) {
                section.classList.add('active');
                section.classList.add('fade-in');
            }

            const mobileTab = document.querySelector(`.mobile-tab[data-section="${sectionName}"]`);
            if (mobileTab) mobileTab.classList.add('active');

            const desktopTab = document.querySelector(`.tab-button[data-tab="${sectionName}"]`);
            if (desktopTab) desktopTab.classList.add('active');

            const breadcrumbTexts = {
                'dashboard': '–ì—É—Ä”Ø“≥“≥–æ',
                'absent-today': '“í–æ–∏–±–æ–Ω',
                'weekly': '“≤–∞—Ñ—Ç–∞–∏–Ω–∞',
                'monthly': '–ú–æ“≥–æ–Ω–∞',
                'problem': '–ü—Ä–æ–±–ª–µ–º–∞'
            };
            const breadcrumb = document.getElementById('breadcrumb-current');
            if (breadcrumb) breadcrumb.textContent = breadcrumbTexts[sectionName] || '–ú–∞—ä–ª—É–º–æ—Ç';

            currentSection = sectionName;

            switch(sectionName) {
                case 'absent-today':
                    loadAbsentStudents();
                    break;
                case 'weekly':
                    loadWeeklyAttendance();
                    break;
                case 'monthly':
                    loadMonthlyAttendance();
                    break;
                case 'problem':
                    loadProblemStudents();
                    break;
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function loadCourses() {
            try {
                const response = await axios.get("/api/courses");
                const select = document.getElementById("course-select");
                select.innerHTML = '<option value="">“≤–∞–º–∞–∏ –∫—É—Ä—Å“≥–æ</option>';
                response.data.forEach(c => {
                    select.innerHTML += `<option value="${c.id}">–ö—É—Ä—Å–∏ ${c.year}</option>`;
                    courseMap.set(c.id, c.year);
                });
            } catch (error) {
                console.error("–•–∞—Ç–æ–≥”£:", error);
                showToast("–•–∞—Ç–æ–≥”£ –¥–∞—Ä –±–æ—Ä–∫—É–Ω–∏–∏ –∫—É—Ä—Å“≥–æ", 'error');
            }
        }

        async function loadGroups() {
            showLoading("groups-mobile");
            const tableBody = document.getElementById("groups-table");
            if (tableBody) tableBody.innerHTML = '<tr><td colspan="6" class="p-8 text-center"><div class="spinner mx-auto"></div></td></tr>';
            
            try {
                const selectedCourseId = document.getElementById("course-select").value;
                const groupsRes = await axios.get("/api/groups" + (selectedCourseId ? `?course_id=${selectedCourseId}` : ""));
                const studentsRes = await axios.get("/api/students/all");
                const attendanceRes = await axios.get("/api/attendance?date=" + new Date().toISOString().split('T')[0]);

                const groups = groupsRes.data;
                const students = studentsRes.data;
                const attendance = attendanceRes.data;

                const mobileContainer = document.getElementById("groups-mobile");
                const desktopTable = document.getElementById("groups-table");
                
                mobileContainer.innerHTML = "";
                desktopTable.innerHTML = "";

                let totalStudents = 0;
                let totalPresent = 0;
                let totalAbsent = 0;

                groups.forEach(g => groupMap.set(g.id, g.number));

                for (let g of groups) {
                    const groupStudents = students.filter(s => s.group_id === g.id);
                    const total = groupStudents.length;
                    
                    const presentStudentsIds = new Set(attendance.filter(a => groupStudents.some(s => s.id === a.student_id) && a.status === "present").map(a => a.student_id));
                    const present = presentStudentsIds.size;
                    const absent = total - present;
                    const percent = total > 0 ? Math.round((present / total) * 100) : 0;
                    
                    totalStudents += total;
                    totalPresent += present;
                    totalAbsent += absent;

                    let progressBarColor = "bg-red-500";
                    if (percent >= 80) progressBarColor = "bg-green-500";
                    else if (percent >= 50) progressBarColor = "bg-yellow-500";

                    mobileContainer.innerHTML += `
                        <div class="mobile-table-card">
                            <div class="flex justify-between items-center mb-3">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-800">–ì—É—Ä”Ø“≥–∏ ${g.number}</h3>
                                    <p class="text-sm text-gray-500">–ö—É—Ä—Å–∏ ${courseMap.get(g.course_id) || g.course_id}</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-indigo-600">${percent}%</div>
                                </div>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">“≤–æ–∑–∏—Ä</span>
                                <span class="mobile-table-value text-green-600">‚úÖ ${present}</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">“í–æ–∏–±</span>
                                <span class="mobile-table-value text-red-600">‚ùå ${absent}</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-3 mb-3">
                                <div class="${progressBarColor} h-2 progress-bar rounded-full" style="width: ${percent}%"></div>
                            </div>
                            <button onclick="loadGroupStudents(${g.id})" class="mobile-action-btn">
                                –î–∏–¥–∞–Ω–∏ —Ä”Ø–π—Ö–∞—Ç ‚Üí
                            </button>
                        </div>`;

                    desktopTable.innerHTML += `
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="p-4 font-bold text-gray-800">${g.number}</td>
                            <td class="p-4 text-gray-600">–ö—É—Ä—Å–∏ ${courseMap.get(g.course_id) || g.course_id}</td>
                            <td class="p-4 text-center">
                                <span class="badge bg-green-100 text-green-700">${present}</span>
                            </td>
                            <td class="p-4 text-center">
                                <span class="badge bg-red-100 text-red-700">${absent}</span>
                            </td>
                            <td class="p-4">
                                <div class="flex items-center gap-3">
                                    <div class="flex-grow bg-gray-200 rounded-full h-3">
                                        <div class="${progressBarColor} h-3 progress-bar rounded-full" style="width: ${percent}%"></div>
                                    </div>
                                    <span class="font-bold text-gray-700 text-sm">${percent}%</span>
                                </div>
                            </td>
                            <td class="p-4 text-center">
                                <button onclick="loadGroupStudents(${g.id})" class="text-indigo-600 hover:text-indigo-800 font-medium hover:underline">
                                    –†”Ø–π—Ö–∞—Ç ‚Üí
                                </button>
                            </td>
                        </tr>`;
                }
                
                if (groups.length === 0) {
                    mobileContainer.innerHTML = '<div class="text-center py-12 text-gray-500">–ì—É—Ä”Ø“≥“≥–æ —ë—Ñ—Ç –Ω–∞—à—É–¥–∞–Ω–¥</div>';
                    desktopTable.innerHTML = '<tr><td colspan="6" class="p-8 text-center text-gray-500">–ì—É—Ä”Ø“≥“≥–æ —ë—Ñ—Ç –Ω–∞—à—É–¥–∞–Ω–¥</td></tr>';
                }

                document.getElementById('total-students').textContent = totalStudents;
                document.getElementById('total-present').textContent = totalPresent;
                document.getElementById('total-absent').textContent = totalAbsent;
                const overallPercent = totalStudents > 0 ? Math.round((totalPresent / totalStudents) * 100) : 0;
                document.getElementById('total-percentage').textContent = `${overallPercent}%`;

            } catch (error) {
                console.error("–•–∞—Ç–æ–≥”£:", error);
                showToast("–•–∞—Ç–æ–≥”£ –¥–∞—Ä –±–æ—Ä–∫—É–Ω–∏–∏ –≥—É—Ä”Ø“≥“≥–æ", 'error');
            }
        }

        async function loadGroupStudents(groupId) {
            try {
                const response = await axios.get(`/api/group_summary/${groupId}`);
                const detail = document.getElementById('group-detail');
                const groupNumber = groupMap.get(groupId) || 'Unknown';
                
                let mobileCards = '';
                let desktopRows = '';

                response.data.forEach(s => {
                    const badgeColor = s.absent_count > 6 ? 'bg-red-100 text-red-700' : s.absent_count > 3 ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700';
                    
                    mobileCards += `
                        <div class="mobile-table-card">
                            <div class="flex justify-between items-center mb-3">
                                <h3 class="text-base font-bold text-gray-800">${s.name}</h3>
                                <span class="badge ${badgeColor}">${s.absent_count} “ì–æ–∏–±”£</span>
                            </div>
                            <button onclick="loadStudentProfile(${s.id}, '${s.name}')" class="mobile-action-btn">
                                –î–∏–¥–∞–Ω–∏ –ø—Ä–æ—Ñ–∏–ª ‚Üí
                            </button>
                        </div>`;

                    desktopRows += `
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="p-4 font-medium text-gray-800">${s.name}</td>
                            <td class="p-4 text-center">
                                <span class="badge ${badgeColor}">${s.absent_count}</span>
                            </td>
                            <td class="p-4 text-center">
                                <button onclick="loadStudentProfile(${s.id}, '${s.name}')" class="text-indigo-600 hover:text-indigo-800 font-medium hover:underline">
                                    –ü—Ä–æ—Ñ–∏–ª ‚Üí
                                </button>
                            </td>
                        </tr>`;
                });

                let html = `
                    <button onclick="hideGroupDetail()" class="back-button">
                        ‚Üê –ë–æ–∑–≥–∞—à—Ç
                    </button>
                    <div class="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl p-4 md:p-6 border-l-4 border-indigo-500 mb-4 fade-in">
                        <h3 class="text-lg md:text-xl font-bold text-gray-800">üìã –ì—É—Ä”Ø“≥–∏ ${groupNumber}</h3>
                        <p class="text-sm text-gray-600 mt-1">–†”Ø–π—Ö–∞—Ç–∏ –¥–æ–Ω–∏—à“∑”Ø—ë–Ω</p>
                    </div>
                    
                    <div class="block md:hidden">${mobileCards}</div>
                    
                    <div class="desktop-table overflow-x-auto rounded-lg border border-gray-200">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100 border-b-2 border-gray-200">
                                <tr>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">–ù–æ–º –≤–∞ –ù–∞—Å–∞–±</th>
                                    <th class="p-4 text-center text-sm font-semibold text-gray-700">“í–æ–∏–±”£</th>
                                    <th class="p-4 text-center text-sm font-semibold text-gray-700">–ê–º–∞–ª–∏—ë—Ç</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">${desktopRows}</tbody>
                        </table>
                    </div>`;
                
                detail.innerHTML = html;
                detail.classList.remove('hidden');
                document.getElementById('student-profile').classList.add('hidden');
                detail.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
            } catch (error) {
                console.error("–•–∞—Ç–æ–≥”£:", error);
                showToast("–•–∞—Ç–æ–≥”£ –¥–∞—Ä –±–æ—Ä–∫—É–Ω–∏–∏ —Ä”Ø–π—Ö–∞—Ç–∏ –¥–æ–Ω–∏—à“∑”Ø—ë–Ω", 'error');
            }
        }

        function hideGroupDetail() {
            document.getElementById('group-detail').classList.add('hidden');
            document.getElementById('student-profile').classList.add('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function loadStudentProfile(studentId, name) {
            try {
                const response = await axios.get(`/api/student_attendance/${studentId}`);
                const profile = document.getElementById('student-profile');
                const absentDates = response.data
                    .filter(a => a.status === "absent")
                    .map(a => new Date(a.date).toLocaleDateString('tg-TJ', { month: 'short', day: 'numeric' }))
                    .sort()
                    .join(', ');
                
                const absentCount = response.data.filter(a => a.status === "absent").length;
                const badgeColor = absentCount > 6 ? 'bg-red-100 text-red-700' : absentCount > 3 ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700';
                
                let html = `
                    <button onclick="hideStudentProfile()" class="back-button">
                        ‚Üê –ë–æ–∑–≥–∞—à—Ç
                    </button>
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-4 md:p-6 border-l-4 border-purple-500 fade-in">
                        <div class="flex flex-col md:flex-row md:items-start md:justify-between mb-4 gap-3">
                            <div>
                                <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-1">üë§ –ü—Ä–æ—Ñ–∏–ª–∏ –¥–æ–Ω–∏—à“∑”Ø</h3>
                                <p class="text-base md:text-lg font-semibold text-gray-700">${name}</p>
                            </div>
                            <span class="badge ${badgeColor} text-base px-4 py-2 self-start">
                                ${absentCount} “ì–æ–∏–±”£
                            </span>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <p class="text-sm font-semibold text-gray-600 mb-2">üìÖ –†”Ø–∑“≥–æ–∏ “ì–æ–∏–±:</p>
                            <p class="text-sm md:text-base text-gray-800">${absentDates || '“í–æ–∏–±”£ –Ω–µ—Å—Ç ‚úÖ'}</p>
                        </div>
                    </div>`;
                
                profile.innerHTML = html;
                profile.classList.remove('hidden');
                profile.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
            } catch (error) {
                console.error("–•–∞—Ç–æ–≥”£:", error);
                showToast("–•–∞—Ç–æ–≥”£ –¥–∞—Ä –±–æ—Ä–∫—É–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª–∏ –¥–æ–Ω–∏—à“∑”Ø", 'error');
            }
        }

        function hideStudentProfile() {
            document.getElementById('student-profile').classList.add('hidden');
        }

        async function loadAbsentStudents() {
            showLoading("absent-mobile");
            const tableBody = document.getElementById("absent-table");
            if (tableBody) tableBody.innerHTML = '<tr><td colspan="3" class="p-8 text-center"><div class="spinner mx-auto"></div></td></tr>';
            
            try {
                const response = await axios.get("/api/absent_students/today");
                const mobileContainer = document.getElementById("absent-mobile");
                const desktopTable = document.getElementById("absent-table");
                
                if (response.data && response.data.length > 0) {
                    let mobileCards = '';
                    let desktopRows = '';

                    response.data.forEach(s => {
                        const isProblematic = s.total_absences > 6;
                        
                        mobileCards += `
                            <div class="mobile-table-card ${isProblematic ? 'border-red-500' : ''}">
                                <h3 class="text-base font-bold ${isProblematic ? 'text-red-600' : 'text-gray-800'} mb-2">
                                    ${s.name}
                                    ${isProblematic ? '<span class="badge bg-red-100 text-red-700 ml-2 text-xs">–ü—Ä–æ–±–ª–µ–º–∞</span>' : ''}
                                </h3>
                                <div class="mobile-table-row">
                                    <span class="mobile-table-label">–ì—É—Ä”Ø“≥</span>
                                    <span class="mobile-table-value">${s.group_number}</span>
                                </div>
                                <div class="mobile-table-row">
                                    <span class="mobile-table-label">–ö—É—Ä—Å</span>
                                    <span class="mobile-table-value">–ö—É—Ä—Å–∏ ${courseMap.get(s.course_id) || s.course_id}</span>
                                </div>
                            </div>`;

                        desktopRows += `
                            <tr class="hover:bg-gray-50 transition-colors">
                                <td class="p-4 font-medium ${isProblematic ? 'text-red-600' : 'text-gray-800'}">
                                    ${s.name}
                                    ${isProblematic ? '<span class="badge bg-red-100 text-red-700 ml-2 text-xs">–ü—Ä–æ–±–ª–µ–º–∞</span>' : ''}
                                </td>
                                <td class="p-4 text-gray-600">${s.group_number}</td>
                                <td class="p-4 text-gray-600">–ö—É—Ä—Å–∏ ${courseMap.get(s.course_id) || s.course_id}</td>
                            </tr>`;
                    });

                    mobileContainer.innerHTML = mobileCards;
                    desktopTable.innerHTML = desktopRows;
                } else {
                    const emptyMessage = `
                        <div class="text-center py-12">
                            <div class="text-5xl mb-3">üìÖ</div>
                            <p class="text-red-600 font-semibold text-base md:text-lg">“≤–æ–ª–æ –∞—Å—Ç—É–Ω–µ—Å—Ç –±–∞ –∞–Ω“∑–æ–º –Ω–∞—Ä–∞—Å–∏–¥–∞–∞—Å—Ç!</p>
                        </div>`;
                    mobileContainer.innerHTML = emptyMessage;
                    desktopTable.innerHTML = `<tr><td colspan="3" class="p-12">${emptyMessage}</td></tr>`;
                }
            } catch (error) {
                console.error("–•–∞—Ç–æ–≥”£:", error);
                showToast("–•–∞—Ç–æ–≥”£ –¥–∞—Ä –±–æ—Ä–∫—É–Ω–∏–∏ —Ä”Ø–π—Ö–∞—Ç–∏ “ì–æ–∏–±–æ–Ω", 'error');
            }
        }

        async function loadWeeklyAttendance() {
            showLoading("weekly-mobile");
            const tableBody = document.getElementById("weekly-table");
            if (tableBody) tableBody.innerHTML = '<tr><td colspan="4" class="p-8 text-center"><div class="spinner mx-auto"></div></td></tr>';
            
            try {
                const response = await axios.get("/api/absent_summary?period=weekly");
                const mobileContainer = document.getElementById("weekly-mobile");
                const desktopTable = document.getElementById("weekly-table");
                
                if (response.data && response.data.length > 0) {
                    let mobileCards = '';
                    let desktopRows = '';

                    response.data.forEach(s => {
                        const badgeColor = s.absent_count > 3 ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700';
                        
                        mobileCards += `
                            <div class="mobile-table-card">
                                <div class="flex justify-between items-center mb-3">
                                    <div class="flex-1">
                                        <h3 class="text-base font-bold text-gray-800">${s.name}</h3>
                                        <p class="text-sm text-gray-500">${s.group_number} ‚Ä¢ –ö—É—Ä—Å–∏ ${courseMap.get(s.course_id) || s.course_id}</p>
                                    </div>
                                    <span class="badge ${badgeColor} text-base">${s.absent_count}</span>
                                </div>
                            </div>`;

                        desktopRows += `
                            <tr class="hover:bg-gray-50 transition-colors">
                                <td class="p-4 font-medium text-gray-800">${s.name}</td>
                                <td class="p-4 text-gray-600">${s.group_number}</td>
                                <td class="p-4 text-gray-600">–ö—É—Ä—Å–∏ ${courseMap.get(s.course_id) || s.course_id}</td>
                                <td class="p-4 text-center">
                                    <span class="badge ${badgeColor}">${s.absent_count}</span>
                                </td>
                            </tr>`;
                    });

                    mobileContainer.innerHTML = mobileCards;
                    desktopTable.innerHTML = desktopRows;
                } else {
                    const emptyMessage = `
                        <div class="text-center py-12">
                            <div class="text-5xl mb-3">‚úÖ</div>
                            <p class="text-green-600 font-semibold text-base md:text-lg">–î–∞—Ä “≥–∞—Ñ—Ç–∞–∏ –≥—É–∑–∞—à—Ç–∞ “ì–æ–∏–±“≥–æ –Ω–µ—Å—Ç–∞–Ω–¥!</p>
                        </div>`;
                    mobileContainer.innerHTML = emptyMessage;
                    desktopTable.innerHTML = `<tr><td colspan="4" class="p-12">${emptyMessage}</td></tr>`;
                }
            } catch (error) {
                console.error("–•–∞—Ç–æ–≥”£:", error);
                showToast("–•–∞—Ç–æ–≥”£ –¥–∞—Ä –±–æ—Ä–∫—É–Ω–∏–∏ –¥–∞–≤–æ–º–æ—Ç–∏ “≥–∞—Ñ—Ç–∞–∏–Ω–∞", 'error');
            }
        }

        async function loadMonthlyAttendance() {
            showLoading("monthly-mobile");
            const tableBody = document.getElementById("monthly-table");
            if (tableBody) tableBody.innerHTML = '<tr><td colspan="4" class="p-8 text-center"><div class="spinner mx-auto"></div></td></tr>';
            
            try {
                const response = await axios.get("/api/absent_summary?period=monthly");
                const mobileContainer = document.getElementById("monthly-mobile");
                const desktopTable = document.getElementById("monthly-table");
                
                if (response.data && response.data.length > 0) {
                    let mobileCards = '';
                    let desktopRows = '';

                    response.data.forEach(s => {
                        const badgeColor = s.absent_count > 6 ? 'bg-red-100 text-red-700' : s.absent_count > 3 ? 'bg-orange-100 text-orange-700' : 'bg-yellow-100 text-yellow-700';
                        
                        mobileCards += `
                            <div class="mobile-table-card">
                                <div class="flex justify-between items-center mb-3">
                                    <div class="flex-1">
                                        <h3 class="text-base font-bold text-gray-800">${s.name}</h3>
                                        <p class="text-sm text-gray-500">${s.group_number} ‚Ä¢ –ö—É—Ä—Å–∏ ${courseMap.get(s.course_id) || s.course_id}</p>
                                    </div>
                                    <span class="badge ${badgeColor} text-base">${s.absent_count}</span>
                                </div>
                            </div>`;

                        desktopRows += `
                            <tr class="hover:bg-gray-50 transition-colors">
                                <td class="p-4 font-medium text-gray-800">${s.name}</td>
                                <td class="p-4 text-gray-600">${s.group_number}</td>
                                <td class="p-4 text-gray-600">–ö—É—Ä—Å–∏ ${courseMap.get(s.course_id) || s.course_id}</td>
                                <td class="p-4 text-center">
                                    <span class="badge ${badgeColor}">${s.absent_count}</span>
                                </td>
                            </tr>`;
                    });

                    mobileContainer.innerHTML = mobileCards;
                    desktopTable.innerHTML = desktopRows;
                } else {
                    const emptyMessage = `
                        <div class="text-center py-12">
                            <div class="text-5xl mb-3">‚úÖ</div>
                            <p class="text-green-600 font-semibold text-base md:text-lg">–î–∞—Ä –º–æ“≥–∏ –≥—É–∑–∞—à—Ç–∞ “ì–æ–∏–±“≥–æ –Ω–µ—Å—Ç–∞–Ω–¥!</p>
                        </div>`;
                    mobileContainer.innerHTML = emptyMessage;
                    desktopTable.innerHTML = `<tr><td colspan="4" class="p-12">${emptyMessage}</td></tr>`;
                }
            } catch (error) {
                console.error("–•–∞—Ç–æ–≥”£:", error);
                showToast("–•–∞—Ç–æ–≥”£ –¥–∞—Ä –±–æ—Ä–∫—É–Ω–∏–∏ –¥–∞–≤–æ–º–æ—Ç–∏ –º–æ“≥–æ–Ω–∞", 'error');
            }
        }

        async function loadProblemStudents() {
            showLoading("problem-mobile");
            const tableBody = document.getElementById("problem-table");
            if (tableBody) tableBody.innerHTML = '<tr><td colspan="4" class="p-8 text-center"><div class="spinner mx-auto"></div></td></tr>';
            
            try {
                const response = await axios.get("/api/problem_students");
                const mobileContainer = document.getElementById("problem-mobile");
                const desktopTable = document.getElementById("problem-table");
                
                if (response.data && response.data.length > 0) {
                    let mobileCards = '';
                    let desktopRows = '';

                    response.data.forEach(s => {
                        mobileCards += `
                            <div class="mobile-table-card border-red-500">
                                <div class="flex justify-between items-center mb-3">
                                    <div class="flex-1">
                                        <h3 class="text-base font-bold text-red-600">‚ö†Ô∏è ${s.name}</h3>
                                        <p class="text-sm text-gray-500">${s.group_number} ‚Ä¢ –ö—É—Ä—Å–∏ ${courseMap.get(s.course_id) || s.course_id}</p>
                                    </div>
                                    <span class="badge bg-red-100 text-red-700 text-base font-bold">${s.total_absences}</span>
                                </div>
                            </div>`;

                        desktopRows += `
                            <tr class="hover:bg-gray-50 transition-colors">
                                <td class="p-4 font-medium text-gray-800">${s.name}</td>
                                <td class="p-4 text-gray-600">${s.group_number}</td>
                                <td class="p-4 text-gray-600">–ö—É—Ä—Å–∏ ${courseMap.get(s.course_id) || s.course_id}</td>
                                <td class="p-4 text-center">
                                    <span class="badge bg-red-100 text-red-700">‚ö†Ô∏è ${s.total_absences}</span>
                                </td>
                            </tr>`;
                    });

                    mobileContainer.innerHTML = mobileCards;
                    desktopTable.innerHTML = desktopRows;
                } else {
                    const emptyMessage = `
                        <div class="text-center py-12">
                            <div class="text-5xl mb-3">‚úÖ</div>
                            <p class="text-green-600 font-semibold text-base md:text-lg">–®–∞—Ö—Å–æ–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ—Å—Ç–∞–Ω–¥!</p>
                        </div>`;
                    mobileContainer.innerHTML = emptyMessage;
                    desktopTable.innerHTML = `<tr><td colspan="4" class="p-12">${emptyMessage}</td></tr>`;
                }
            } catch (error) {
                console.error("–•–∞—Ç–æ–≥”£:", error);
                showToast("–•–∞—Ç–æ–≥”£ –¥–∞—Ä –±–æ—Ä–∫—É–Ω–∏–∏ —Ä”Ø–π—Ö–∞—Ç–∏ —à–∞—Ö—Å–æ–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∞", 'error');
            }
        }

        async function generateMonthlyReport() {
            if (!isMonthComplete()) {
                showToast("“≤–∏—Å–æ–±–æ—Ç–∏ –º–æ“≥–æ–Ω–∞ —Ç–∞–Ω“≥–æ –ø–∞—Å –∞–∑ –∞–Ω“∑–æ–º–∏ –º–æ“≥ –¥–∞—Å—Ç—Ä–∞—Å –∞—Å—Ç!", 'error');
                return;
            }

            const buttons = document.querySelectorAll('.mobile-tab[data-section="report"], .tab-button[data-tab="report"]');
            const originalTexts = Array.from(buttons).map(btn => btn.innerHTML);
            
            buttons.forEach(btn => {
                btn.innerHTML = '<div class="mobile-tab-icon">‚è≥</div><div>–°–∞–±—Ä...</div>';
                btn.disabled = true;
            });
            
            try {
                const response = await axios.get("/api/generate_monthly_report");
                showToast(response.data.message, 'success');
            } catch (error) {
                console.error("–•–∞—Ç–æ–≥”£:", error);
                const errorMessage = error.response?.data?.detail || "–•–∞—Ç–æ–≥”£ “≥–∞–Ω–≥–æ–º–∏ –≥–µ–Ω–µ—Ä–∞—Ç—Å–∏—è–∏ “≥–∏—Å–æ–±–æ—Ç–∏ –º–æ“≥–æ–Ω–∞";
                showToast(errorMessage, 'error');
            } finally {
                buttons.forEach((btn, index) => {
                    btn.innerHTML = originalTexts[index];
                    btn.disabled = !isMonthComplete();
                });
            }
        }

        setInterval(() => {
            if (currentSection === 'dashboard') {
                loadGroups();
            }
        }, 60000);

        document.addEventListener('DOMContentLoaded', () => {
            updateCurrentDate();
            updateReportButtonState();
            setInterval(updateCurrentDate, 60000);
            setInterval(updateReportButtonState, 60000);
            
            loadCourses().then(() => {
                loadGroups();
            });
        });
    </script>
</body>
</html>